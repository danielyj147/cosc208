# Advanced C Features

## 2.9.5 C Libraries: Using, Compiling, and Linking

C libraries are consisted of two parts:

1. API: Defines what's users can access. uses .h extension.
2. Implementation: pre-compiled binary format or archive file(.a) or shared object file(.so). gets linked(added) to the binary executable created by gcc.

> precompiled vs compiled binary  
> precompiled file cannot be run on  its own.

to statically link

use --static

otherwise, use -l&lt;lib-name&gt;

### Compilation Steps

Requires 4 + 1 steps

1. **Precompiler**: expands preprocessor directives(`#define`, `#include`)
   1. Possible Errors: syntax, cannot find associaated header file for `#include`
   2. Use `gcc -E <filename.c>` to see intermediate results.
2. **Compile**: translates code(.c) to assembly(.s)
   1. Possible errors: syntax, undefined symbol warning, missing def/func prototypes.
   2. Use `gcc -S <filename.c>` to see intermediate results.
3. **Assembly**: Converts the assembly code into relocatable binary object code(.o)
   1. is binary, but not executable by itself.
   2. in the format of ELF(excutable and linkable format)
   3. `gcc -c <filename.c>`
   4. .out & .o file can be viewed by `objdump -d <filename.o>`
4. **Link Editing**: creates a single executable file(.out) from relocatable binaries(.o) & libs(.a or .so)

    All calls to a lib(.a) are bound to a location in the a.out file.

    Shared object(.so) is diffrent. It is dynamically linked. .out fontians info about which dynamically linked libs are needed. This requires an additional linking step at runtime.

5. \***Runtime Linking**: needed when .so was used. Links .so to .out.
   1. `ldd a.out` lists shared object dependencies.

gcc searches /usr/include for header files and /usr/lib for library files & also looks for header files in the current working directory.

You can explicitly provide header/lib file.

```bash
gcc  -I/home/me/include -o myprog myprog.c -L/home/me/lib -lexamplelib

```

To specify the location of a dynamic lib(.so), set the LD_LIBRARY_PATH environment variable to include the path to the library.

```bash
export LD_LIBRARY_PATH=/home/me/lib:$LD_LIBRARY_PATH
```

To simplyfy the execution process, we can use `Makefile`